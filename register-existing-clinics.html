<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Register Existing Clinics - MyMedPH</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body class="bg-gradient-to-br from-blue-600 to-purple-700 min-h-screen flex items-center justify-center p-4">
    
    <div class="bg-white rounded-xl shadow-2xl p-8 max-w-2xl w-full">
        <div class="text-center mb-8">
            <i class="fas fa-hospital text-6xl text-blue-500 mb-4"></i>
            <h1 class="text-3xl font-bold text-gray-800 mb-2">Register Clinics</h1>
            <p class="text-gray-600">Checking and registering clinics in the database...</p>
        </div>
        
        <div id="status" class="space-y-4">
            <div class="flex items-center justify-center">
                <div class="relative">
                    <div class="w-16 h-16 border-4 border-blue-200 border-t-blue-600 rounded-full animate-spin"></div>
                </div>
            </div>
            <p class="text-center text-gray-600 font-semibold">Loading...</p>
            <p class="text-center text-sm text-gray-500">Please wait while we check existing clinics</p>
        </div>
        
        <div id="result" class="hidden"></div>
    </div>
    
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
    
    <script>
        // Firebase Configuration
        const firebaseConfig = {
            apiKey: "AIzaSyCjJLE_Mgrv3HONhkkgApmUNVlGdnAIcvI",
            authDomain: "clinic-a17bc.firebaseapp.com",
            projectId: "clinic-a17bc",
            storageBucket: "clinic-a17bc.firebasestorage.app",
            messagingSenderId: "5214960983",
            appId: "1:5214960983:web:4da52f47c510a50b3cd212",
            measurementId: "G-7YM2Z0BY98"
        };
        
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();
        
        // Your 3 existing clinics
        const clinics = [
            {
                id: 'clinic1',
                name: 'Zamboanga Dental Clinic',
                slug: 'zamboanga',
                address: '123 Dental Street, Zamboanga City, Philippines',
                phone: '+63 917 123 4567',
                email: 'info@zamboangadental.com',
                status: 'active',
                branding: {
                    primaryColor: '#0066cc',
                    secondaryColor: '#00cc66',
                    logo: ''
                }
            },
            {
                id: 'clinic2',
                name: 'Manila Smile Center',
                slug: 'manila',
                address: '456 Smile Avenue, Manila, Philippines',
                phone: '+63 917 234 5678',
                email: 'info@manilasmile.com',
                status: 'active',
                branding: {
                    primaryColor: '#0066cc',
                    secondaryColor: '#00cc66',
                    logo: ''
                }
            },
            {
                id: 'clinic3',
                name: 'Cebu Dental Care',
                slug: 'cebu',
                address: '789 Care Street, Cebu City, Philippines',
                phone: '+63 917 345 6789',
                email: 'info@cebudentalcare.com',
                status: 'active',
                branding: {
                    primaryColor: '#0066cc',
                    secondaryColor: '#00cc66',
                    logo: ''
                }
            }
        ];
        
        async function registerClinics() {
            try {
                const results = [];
                let addedCount = 0;
                let skippedCount = 0;
                
                for (const clinic of clinics) {
                    // Check if clinic already exists
                    const existingDoc = await db.collection('clinics').doc(clinic.id).get();
                    
                    if (existingDoc.exists) {
                        results.push({ type: 'skipped', clinic: clinic.name, message: 'Already exists' });
                        skippedCount++;
                    } else {
                        // Create clinic document
                        await db.collection('clinics').doc(clinic.id).set({
                            name: clinic.name,
                            slug: clinic.slug,
                            address: clinic.address,
                            phone: clinic.phone,
                            email: clinic.email,
                            status: clinic.status,
                            branding: clinic.branding,
                            active: true,
                            createdAt: firebase.firestore.FieldValue.serverTimestamp()
                        });
                        
                        results.push({ type: 'added', clinic: clinic.name, message: 'Registered successfully!' });
                        addedCount++;
                    }
                }
                
                // Success!
                document.getElementById('status').classList.add('hidden');
                document.getElementById('result').classList.remove('hidden');
                
                const summaryText = addedCount > 0 
                    ? `${addedCount} clinic${addedCount > 1 ? 's' : ''} registered successfully!`
                    : 'All clinics already registered!';
                
                document.getElementById('result').innerHTML = `
                    <div class="text-center space-y-4">
                        <i class="fas fa-${addedCount > 0 ? 'check-circle text-green-500' : 'info-circle text-blue-500'} text-6xl"></i>
                        <h2 class="text-2xl font-bold text-gray-800">Process Complete!</h2>
                        <p class="text-lg text-gray-600">${summaryText}</p>
                        
                        <div class="bg-gray-50 border-l-4 border-gray-400 p-4 text-left">
                            <p class="font-bold text-gray-800 mb-3">Summary:</p>
                            <div class="space-y-2">
                                ${addedCount > 0 ? `<p class="text-sm text-green-700"><i class="fas fa-check-circle mr-2"></i><strong>${addedCount}</strong> clinic${addedCount > 1 ? 's' : ''} added</p>` : ''}
                                ${skippedCount > 0 ? `<p class="text-sm text-yellow-700"><i class="fas fa-exclamation-triangle mr-2"></i><strong>${skippedCount}</strong> clinic${skippedCount > 1 ? 's' : ''} already existed</p>` : ''}
                            </div>
                        </div>
                        
                        <div class="bg-white border border-gray-200 rounded-lg p-4 text-left max-h-64 overflow-y-auto">
                            <p class="font-bold text-gray-800 mb-3">Details:</p>
                            <div class="space-y-2">
                                ${results.map(r => `
                                    <div class="flex items-start space-x-2 text-sm">
                                        <i class="fas fa-${r.type === 'added' ? 'check-circle text-green-600' : 'info-circle text-yellow-600'} mt-1"></i>
                                        <div>
                                            <span class="font-semibold">${r.clinic}</span>
                                            <span class="text-gray-600"> - ${r.message}</span>
                                        </div>
                                    </div>
                                `).join('')}
                            </div>
                        </div>
                        
                        <button onclick="window.close()" class="w-full bg-blue-600 text-white px-6 py-3 rounded-lg font-semibold hover:bg-blue-700 transition">
                            <i class="fas fa-times mr-2"></i>Close This Tab
                        </button>
                        
                        <p class="text-xs text-gray-500 mt-4">
                            <i class="fas fa-info-circle mr-1"></i>
                            Go back to Super Admin and refresh to see the clinics!
                        </p>
                    </div>
                `;
                
            } catch (error) {
                console.error('Error:', error);
                document.getElementById('status').classList.add('hidden');
                document.getElementById('result').classList.remove('hidden');
                document.getElementById('result').innerHTML = `
                    <div class="text-center space-y-4">
                        <i class="fas fa-exclamation-circle text-6xl text-red-500"></i>
                        <h2 class="text-2xl font-bold text-gray-800">Error</h2>
                        <p class="text-gray-600">${error.message}</p>
                        <button onclick="location.reload()" 
                                class="bg-red-600 text-white px-6 py-3 rounded-lg font-semibold hover:bg-red-700 transition">
                            Try Again
                        </button>
                    </div>
                `;
            }
        }
        
        // Auto-run on page load
        setTimeout(registerClinics, 1000);
    </script>
</body>
</html>
